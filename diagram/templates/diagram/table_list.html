<div class="layout">
    <div class="panel" x-data="{ search: '' }">
        <h2>Select Tables & Columns</h2>
        <p style="color: #7f8c8d; font-size: 14px; margin-bottom: 15px;">
            Click tables to select. Key columns (PK, FK, UK) are auto-selected.
        </p>

        <input type="text"
               x-model="search"
               placeholder="Search tables..."
               style="margin-bottom: 15px;">

        <div id="table-list">
            {% for table_name, table_info in tables.items %}
                {% with table_id=table_name|slugify %}
                <div class="table-item" id="table-{{ table_id }}"
                     x-data="{ expanded: false }"
                     x-show="!search || '{{ table_name }}'.toLowerCase().includes(search.toLowerCase())">
                    <div class="table-header"
                         @click="document.getElementById('check-{{ table_id }}').click()">
                        <input type="checkbox"
                               id="check-{{ table_id }}"
                               hx-post="{% url 'diagram:toggle_table' %}"
                               hx-target="#columns-{{ table_id }}"
                               hx-vals='{"table_name": "{{ table_name }}", "selected": "true"}'
                               hx-trigger="change"
                               @click.stop
                               onchange="
                                   this.setAttribute('hx-vals', JSON.stringify({
                                       table_name: '{{ table_name }}',
                                       selected: String(this.checked)
                                   }));
                                   if (this.checked) {
                                       document.getElementById('table-{{ table_id }}').classList.add('selected');
                                   } else {
                                       document.getElementById('table-{{ table_id }}').classList.remove('selected');
                                   }
                               ">
                        <label for="check-{{ table_id }}" class="table-name" @click.stop>{{ table_name }}</label>
                        <button type="button"
                                @click.stop="expanded = !expanded"
                                style="background: none; border: none; cursor: pointer; font-size: 16px; margin-left: auto; padding: 4px 8px;"
                                x-text="expanded ? '▼' : '▶'">
                        </button>
                    </div>
                    <div id="columns-{{ table_id }}" x-show="expanded"></div>
                </div>
                {% endwith %}
            {% endfor %}
        </div>
    </div>

    <div class="panel">
        <h2>Mermaid Diagram</h2>
        <p style="color: #7f8c8d; font-size: 14px; margin-bottom: 15px;">
            Diagram updates automatically as you select tables.
        </p>

        <div id="diagram-output" class="output-area">
            <p style="color: #7f8c8d; font-size: 14px;">
                Select tables to see the diagram.
            </p>
        </div>
    </div>
</div>
