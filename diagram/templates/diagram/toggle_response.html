<!-- Column list (normal swap target) -->
<div class="column-list">
    {% for col_info in table_info.columns %}
        <div class="column-item">
            <input type="checkbox"
                   id="col-{{ table_name|slugify }}-{{ col_info.name|slugify }}"
                   {% if col_info.name in selected_columns %}checked{% endif %}
                   hx-post="{% url 'diagram:toggle_column' %}"
                   hx-vals='{"table_name": "{{ table_name }}", "column_name": "{{ col_info.name }}", "selected": "{% if col_info.name not in selected_columns %}true{% else %}false{% endif %}"}'
                   hx-trigger="change"
                   onchange="this.setAttribute('hx-vals', JSON.stringify({table_name: '{{ table_name }}', column_name: '{{ col_info.name }}', selected: String(this.checked)}))">
            <label for="col-{{ table_name|slugify }}-{{ col_info.name|slugify }}" class="column-name">
                {{ col_info.name }}
            </label>
            <span class="column-type">{{ col_info.type }}</span>

            {% if col_info.name in table_info.primary_keys %}
                <span class="badge badge-pk">PK</span>
            {% endif %}
            {% if col_info.name in foreign_key_columns %}
                <span class="badge badge-fk">FK</span>
            {% endif %}
            {% if col_info.name in table_info.unique_keys %}
                <span class="badge badge-uk">UK</span>
            {% endif %}
        </div>
    {% endfor %}
</div>

<!-- Diagram output (OOB swap) -->
<div id="diagram-output" class="output-area" hx-swap-oob="true">
    {% if has_selection %}
        <div style="background: white; padding: 20px; border-radius: 4px; margin-bottom: 20px; border: 1px solid #ddd;">
            <pre class="mermaid">{{ mermaid_code }}</pre>
        </div>

        <details style="margin-bottom: 20px;">
            <summary style="cursor: pointer; padding: 10px; background: #f8f9fa; border-radius: 4px; font-weight: 500;">
                Show Mermaid Code
            </summary>
            <div class="mermaid-code" style="margin-top: 10px;">{{ mermaid_code }}</div>
        </details>

        <div class="button-group">
            <button onclick="navigator.clipboard.writeText(`{{ mermaid_code|escapejs }}`).then(() => {
                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = 'Copied!';
                setTimeout(() => btn.textContent = originalText, 2000);
            })">
                Copy Code to Clipboard
            </button>

            <a href="{% url 'diagram:download_diagram' %}" style="text-decoration: none;">
                <button type="button" class="btn-secondary">
                    Download .mmd File
                </button>
            </a>
        </div>
    {% else %}
        <p style="color: #7f8c8d; font-size: 14px;">
            Select tables to see the diagram.
        </p>
    {% endif %}
</div>
